(function(a){a.fn.extend({imgUpload:function(e){var h=a.extend({},b,e);function j(m){if(typeof m.fileData!=="undefined"){var k=new FileReader();k.onload=function(n){m.previewBox.html('<img src="'+n.target.result+'" class="yyy-preview-img" />')};k.readAsDataURL(m.fileData)}else{var l=m.fileEle[0];if((l.files&&l.files[0])){var k=new FileReader();k.onload=function(n){m.previewBox.html('<img src="'+n.target.result+'" class="yyy-preview-img" />')};k.readAsDataURL(l.files[0])}else{m.previewBox.html('<div class="yyy-preview-img" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\''+l.value+"'\"></div>")}}}function i(k){if(k.method==="form"){var l=a('<form id="yyy-temp-form" name="yyy-temp-form" method="POST"  enctype="multipart/form-data"></form>');a("body").append(l);l.append(k.fileEle).ajaxSubmit({url:h.url,type:"POST",timeout:3000,success:function(n){if(typeof k.succCb!=="undefined"){k.succCb(n)}k.fileEle.appendTo(k.containerEle);l.remove()},error:function(n){if(typeof k.failCb!=="undefined"){k.failCb(n)}k.fileEle.appendTo(k.containerEle);l.remove()}})}else{if(k.method==="formdata"){var m=new FormData();m.append("pic",k.fileData);a.ajax({url:h.url,type:"POST",data:m,contentType:false,processData:false,success:function(n){if(typeof k.succCb!=="undefined"){k.succCb(n)}},error:function(n){if(typeof k.failCb!=="undefined"){k.failCb(n)}}})}}}function f(l,m){var k=a('<form id="yyy-reset-form" name="yyy-reset-form" method="POST"  enctype="multipart/form-data"></form>');a("body").append(k);k.append(l);k[0].reset();l.appendTo(m);k.remove()}function c(l,m){var k=l.size;return(m===0)||(m!==0&&k/1024<=m)?false:true}function g(l,k,n){n=n||false;var m=n?l.name.split(".")[1]:l.val().split(".")[1];return k.indexOf(m)===-1?false:true}function d(m,n,l,k){m.forEach(function(o){o.addClass("yyy-hide")});n.forEach(function(o){o.removeClass("yyy-hide")});if(l&&l.length>0){l.html(k||"")}}return this.each(function(){var n=a(this);n.html('<label class="yyy-ipt-label"><input type="file" accept="image/*" name="pic" class="yyy-img-ipt"></label>'+'<div class="yyy-preview-box"><img src="" class="yyy-preview-img"></div>'+'<div class="yyy-btn-group">'+'<div class="yyy-btn-del yyy-hide"></div>'+'<div class="yyy-btn-upload yyy-hide"></div>'+'<div class="yyy-btn-retry yyy-hide"></div>'+"</div>"+'<div class="yyy-tip-load yyy-hide">'+'<div class="yyy-loader">Loading...</div>'+"</div>"+'<div class="yyy-tip-info"></div>');var t=n.find(".yyy-img-ipt");var o=n.find(".yyy-ipt-label");var m=n.find(".yyy-preview-box");var w=n.find(".yyy-btn-del");var x=n.find(".yyy-btn-retry");var p=n.find(".yyy-btn-upload");var r=n.find(".yyy-tip-load");var l=n.find(".yyy-tip-info");var s=[];var u=[w,x,p,r];var k=[w];var z=[w,x];var B=[w,r];var q=[w,p];var v=[w];var y=false;var A="";t.on("change",function(){y=false;A="";j({fileEle:t,previewBox:m});d(u,s,l,"");if(t.val()===""){return}if(h.oversize!==0){if(c(t[0].files[0],h.maxSize)){d(u,v,l,"图片太大");return}}if(!g(t,h.imgType)){d(u,v,l,"图片格式不正确");return}if(h.immediatelyUpload){p.trigger("click")}else{d(u,q)}});if(h.allowDrag&&window.FileReader){o.on("dragover",function(C){C.preventDefault();n.addClass("yyy-file-in")});o.on("dragleave",function(C){C.preventDefault();n.removeClass("yyy-file-in")});o.on("drop",function(C){C.stopPropagation();C.preventDefault();y=true;A=C.originalEvent.dataTransfer.files[0];j({fileData:A,previewBox:m});n.removeClass("yyy-file-in");if(h.oversize!==0&&A){if(c(A,h.maxSize)){d(u,v,l,"图片太大");return}}if(!g(A,h.imgType,true)){d(u,v,l,"图片格式不正确");return}if(h.immediatelyUpload){p.trigger("click")}else{d(q,u)}})}else{t.on("drop",function(C){C.preventDefault()})}w.on("click",function(){n.find(".yyy-preview-img").attr("src","").css("filter","");f(t,o);y=false;A="";d(u,s,l,"")});p.on("click",function(){d(u,B,l,"");if(!h.beforeUpload(t)){d(u,q,l,"发生异常");return}var C={succCb:function(D){d(u,k,l,"上传成功");h.succCb(D)},failCb:function(D){d(u,z,l,"上传失败，请重试");h.failCb(D)}};if(y&&A!==""){C.method="formdata";C.fileData=A;i(C)}else{C.method="form";C.fileEle=t;C.containerEle=o;i(C)}});x.on("click",function(){p.trigger("click")})})}});var b={immediatelyUpload:false,url:"",maxSize:"",imgType:["gif","jpeg","jpg","png","bmp"],allowDrag:false,beforeUpload:function(c){return true},succCb:function(c){},failCb:function(c){}}})(jQuery);